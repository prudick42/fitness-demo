<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - {{ role|capitalize }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>–§–∏—Ç–Ω–µ—Å-–∫–ª—É–± - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
            <div class="user-info">
                –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: 
                <span class="role-badge role-{{ role }}">{{ role|upper }}</span>
                - {{ session.display_name }}
                <a href="{{ url_for('logout') }}" class="btn-logout">–í—ã–π—Ç–∏</a>
            </div>
        </header>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="alert">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <nav class="nav">
            <h2>–ú–µ–Ω—é:</h2>
            <ul>
                {% if role in ['admin', 'manager'] %}
                <li><a href="{{ url_for('clients') }}">üë• –ö–ª–∏–µ–Ω—Ç—ã</a></li>
                {% endif %}
                
                {% if role == 'admin' %}
                <li><a href="{{ url_for('add_client') }}">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</a></li>
                {% endif %}
                
                {% if role in ['admin', 'manager'] %}
                <li><a href="{{ url_for('trainers_list') }}">üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä—ã</a></li>
                {% endif %}
                
                {% if role == 'admin' %}
                <li><a href="{{ url_for('add_trainer') }}">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–µ—Ä–∞</a></li>
                {% endif %}
                
                <li><a href="{{ url_for('subscriptions') }}">üé´ –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</a></li>
                
                {% if role in ['admin', 'client'] %}
                <li><a href="{{ url_for('buy_subscription') }}">üí∞ –ö—É–ø–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç</a></li>
                {% endif %}
                
                <li><a href="{{ url_for('trainings') }}">üèãÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a></li>
                
                {% if role == 'admin' %}
                <li><a href="{{ url_for('add_training') }}">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</a></li>
                {% endif %}
                
                {% if role in ['admin', 'client', 'trainer'] %}
                <li><a href="{{ url_for('bookings_list') }}">üìù –ú–æ–∏ –∑–∞–ø–∏—Å–∏</a></li>
                {% endif %}
                
                {% if role in ['admin', 'client'] %}
                <li><a href="{{ url_for('book_training') }}">‚ûï –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</a></li>
                {% endif %}
                
                {% if role in ['admin', 'manager'] %}
                <li><a href="{{ url_for('financial_report') }}">üìä –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç</a></li>
                <li><a href="{{ url_for('attendance_report') }}">üìà –û—Ç—á–µ—Ç –ø–æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</a></li>
                {% endif %}
            </ul>
        </nav>
        
        <main class="main-content">
            <h2>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - {{ role|capitalize }}</h2>
            
            {% if role == 'admin' %}
            <div class="stats">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>–ö–ª–∏–µ–Ω—Ç–æ–≤</h4>
                        <p class="stat-number">{{ data.clients_count }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>–¢—Ä–µ–Ω–µ—Ä–æ–≤</h4>
                        <p class="stat-number">{{ data.trainers_count }}</p>
                    </div>
                    <div class="stat-card">
                        <h4>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h4>
                        <p class="stat-number">{{ data.trainings_count }}</p>
                    </div>
                </div>
                
                {% if data.recent_clients %}
                <div class="recent-section">
                    <h4>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã:</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–§–ò–û</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>Email</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for client in data.recent_clients %}
                            <tr>
                                <td>{{ client[0] }}</td>
                                <td>{{ client[1] }}</td>
                                <td>{{ client[2] }}</td>
                                <td>{{ client[3] or '-' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>
            
            {% elif role == 'client' and data.client %}
            <div class="client-profile">
                <h3>üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:</h3>
                <div class="profile-card">
                    <p><strong>–§–ò–û:</strong> {{ data.client.name }}</p>
                    <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ data.client.phone }}</p>
                    <p><strong>Email:</strong> {{ data.client.email or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
                    <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ data.client.birth_date or '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}</p>
                    <p><strong>–ü–æ–ª:</strong> {{ data.client.gender }}</p>
                    
                    {% if data.subscription %}
                    <div class="subscription-info">
                        <h4>üé´ –ê–∫—Ç–∏–≤–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç:</h4>
                        <p><strong>–¢–∏–ø:</strong> {{ data.subscription.type }}</p>
                        <p><strong>–¶–µ–Ω–∞:</strong> {{ data.subscription.price }} ‚ÇΩ</p>
                        <p><strong>–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏:</strong> {{ data.subscription.date }}</p>
                        <p><strong>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</strong> {{ data.subscription.method }}</p>
                        <p><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{ data.subscription.duration }} –¥–Ω–µ–π</p>
                    </div>
                    {% else %}
                    <div class="no-subscription">
                        <p>–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞.</p>
                        <a href="{{ url_for('buy_subscription') }}" class="btn">–ö—É–ø–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç</a>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            {% elif role == 'trainer' %}
            <div class="trainer-info">
                <h3>üë®‚Äçüè´ –ü–∞–Ω–µ–ª—å —Ç—Ä–µ–Ω–µ—Ä–∞</h3>
                
                {% if data.trainer %}
                <div class="profile-card">
                    <p><strong>–§–ò–û:</strong> {{ data.trainer.name }}</p>
                    <p><strong>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</strong> {{ data.trainer.specialization }}</p>
                    <p><strong>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã:</strong> {{ data.trainer.experience }} –ª–µ—Ç</p>
                </div>
                
                {% if data.upcoming_trainings %}
                <div class="trainings-section">
                    <h4>üìÖ –ë–ª–∏–∂–∞–π—à–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–¢–∏–ø</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for training in data.upcoming_trainings %}
                            <tr>
                                <td>{{ training[0] }}</td>
                                <td>{{ training[1] }}</td>
                                <td>{{ training[2] }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p>–ù–∞ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ.</p>
                {% endif %}
                
                {% else %}
                <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–Ω–µ—Ä–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.</p>
                {% endif %}
                
                <div class="quick-links">
                    <a href="{{ url_for('trainings') }}" class="btn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a>
                    <a href="{{ url_for('bookings_list') }}" class="btn">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø–∏—Å–∏</a>
                </div>
            </div>
            
            {% elif role == 'manager' %}
            <div class="manager-info">
                <h3>üìä –ü–∞–Ω–µ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</h4>
                        <p class="stat-number">{{ "%.2f"|format(data.total_revenue) }} ‚ÇΩ</p>
                    </div>
                    <div class="stat-card">
                        <h4>–í—Å–µ–≥–æ –ø—Ä–æ–¥–∞–∂</h4>
                        <p class="stat-number">{{ data.total_sales }}</p>
                    </div>
                </div>
                
                {% if data.subscription_stats %}
                <div class="report-preview">
                    <h4>üìà –ü—Ä–æ–¥–∞–∂–∏ –ø–æ —Ç–∏–ø–∞–º –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤:</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>–¢–∏–ø –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞</th>
                                <th>–ü—Ä–æ–¥–∞–Ω–æ</th>
                                <th>–í—ã—Ä—É—á–∫–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in data.subscription_stats %}
                            <tr>
                                <td>{{ stat[0] }}</td>
                                <td>{{ stat[1] }}</td>
                                <td>{{ "%.2f"|format(stat[2]) }} ‚ÇΩ</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
                
                <div class="quick-links">
                    <a href="{{ url_for('financial_report') }}" class="btn">–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç</a>
                    <a href="{{ url_for('attendance_report') }}" class="btn">–û—Ç—á–µ—Ç –ø–æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</a>
                </div>
            </div>
            
            {% endif %}
        </main>
        
        <footer class="footer">
            <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏—Ç–Ω–µ—Å-–∫–ª—É–±–æ–º | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL</p>
        </footer>
    </div>
</body>
</html>